package com.pozatticaique.hrpayroll.config;

import org.springframework.cloud.client.DefaultServiceInstance;
import org.springframework.cloud.client.ServiceInstance;
import org.springframework.cloud.client.loadbalancer.LoadBalancerClient;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MyLoadBalancerConfiguration {

    @Bean
    public LoadBalancerClient loadBalancerClient() {
        return new LoadBalancerClient() {
            @Override
            public ServiceInstance choose(String serviceId) {
                if ("hr-worker".equals(serviceId)) {
                    // Simula o balanceamento de carga alternando entre as duas inst√¢ncias
                    int instance = (int) (System.currentTimeMillis() % 2);
                    String instanceId = "instance" + (instance + 1);
                    return new DefaultServiceInstance(instanceId, serviceId, "localhost", 8001 + instance, false);
                }
                return null;
            }
        };
    }

}

