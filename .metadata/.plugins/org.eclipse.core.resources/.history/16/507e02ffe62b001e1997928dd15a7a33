package com.pozatticaique.hrpayroll.config;

import java.net.URI;
import java.util.ArrayList;
import java.util.List;

import org.springframework.cloud.client.ServiceInstance;
import org.springframework.cloud.loadbalancer.core.ServiceInstanceListSupplier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MyLoadBalancerConfiguration {

    @Bean
    public ServiceInstanceListSupplier serviceInstanceListSupplier() {
        List<ServiceInstance> instances = new ArrayList<>();
        instances.add(new DefaultServiceInstance("instance1", "hr-worker", "localhost", 8001, false));
        instances.add(new DefaultServiceInstance("instance2", "hr-worker", "localhost", 8002, false));

        return ServiceInstanceListSupplier.fixed("hr-worker", instances);
    }

    private static class DefaultServiceInstance implements ServiceInstance {
        private final String serviceId;
        private final String host;
        private final int port;
        private final boolean secure;

    public DefaultServiceInstance(String serviceId, String host, int port, boolean secure) {
    	this.serviceId = serviceId;
        this.host = host;
        this.port = port;
        this.secure = secure;
    }

	@Override
	public String getServiceId() {
		return serviceId;
	}

	@Override
	public String getHost() {
		return host;
	}

	@Override
	public int getPort() {
		return port;
	}

	@Override
	public boolean isSecure() {
		return secure;
	}

	@Override
	public URI getUri() {
		return URI.create((secure ? "https://" : "http://") + host + ":" + port);
	}
    }

}